(function(){$('#add-event-btn').click(()=>$('#add-event').fadeToggle('fast'));$('#add-event form .close-btn').click(event=>{event.preventDefault();$('#add-event').fadeToggle('fast')});$('#add-event-do').click(event=>{event.preventDefault();const $addForm=$('#add-event-form');$('#add-event').fadeToggle('fast');createEvent($addForm)});$('body').on("click",'li.edit-event',event=>{const eventID=$(event.target).data('event-id');const $eventCard=$(event.target).closest('.event-card');const currentName=$eventCard.find('h2').text();const currentDescription=$eventCard.find('span.event-description').text();const currentLocation=$eventCard.find('span.event-location').text();const currentAddress=$eventCard.find('span.event-address').text();const currentDate=$eventCard.find('span.event-date').text();const currentPassword=$eventCard.find('span.event-password').text();let currentTime=$eventCard.find('span.event-time').text();let currentEndTime=$eventCard.find('span.event-end-time').text();let currentDeadline=$eventCard.find('span.event-rsvp-deadline').text();let currentGuestAllow=$eventCard.find('span.event-allow-guests').text();if(currentGuestAllow==='Yes'){currentGuestAllow='checked'}else{currentGuestAllow=''}
if(currentTime.startsWith('0')){currentTime=currentTime.substring(1)}
if(currentEndTime.startsWith('0')){currentEndTime=currentEndTime.substring(1)}
if(currentDeadline.startsWith('0')){currentDeadline=currentDeadline.substring(1)}
$eventCard.find('#details-'+eventID).fadeOut('fast',()=>{$eventCard.find('.mdl-card__supporting-text').append(`
          <form method="POST" id="edit-event-form">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <label class="mdl-textfield__label" for="edit-event-name">Event Name</label>
              <input class="mdl-textfield__input" type="text" id="edit-event-name" name="edit-event-name" value="${currentName}">
            </div>
            <br />
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <textarea class="mdl-textfield__input" type="text" rows="3" id="edit-event-description" name="edit-event-description" >${currentDescription}</textarea>
              <label class="mdl-textfield__label" for="edit-event-description">Description</label>
            </div>
            <br />
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <label class="mdl-textfield__label" for="edit-event-location">Location</label>
              <input class="mdl-textfield__input" type="text" id="edit-event-location" name="edit-event-location" value="${currentLocation}">
            </div>
            <br />
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <label class="mdl-textfield__label" for="edit-event-address">Address</label>
              <input class="mdl-textfield__input" type="text" id="edit-event-address" name="edit-event-address" value="${currentAddress}">
            </div>
            <br />
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <label class="mdl-textfield__label" for="edit-event-date">Date</label>
              <input class="mdl-textfield__input" type="text" id="edit-event-date" name="edit-event-date" pattern="^([0]?[1-9]|[1][0-2])[./-]([0]?[1-9]|[1|2][0-9]|[3][0|1])[./-]([0-9]{4}|[0-9]{2})$" placeholder="MM/DD/YYYY" value="${currentDate}">
              <span class="mdl-textfield__error">Please use this format: MM/DD/YYYY</span>
            </div>
            <br />
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <label class="mdl-textfield__label" for="edit-event-time">Time</label>
              <input class="mdl-textfield__input" type="text" id="edit-event-time" name="edit-event-time" placeholder="XX:XX AM/PM" pattern="^ *(1[0-2]|[1-9]):[0-5][0-9] *(a|p|A|P)(m|M) *$" value="${currentTime}">
              <span class="mdl-textfield__error">Please use this format: XX:XX AM/PM</span>
            </div>
            <br />
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <label class="mdl-textfield__label" for="edit-event-end-time">End Time <em>(Won\'t show this if left empty)</em></label>
              <input class="mdl-textfield__input" type="text" id="edit-event-end-time" name="edit-event-end-time" placeholder="XX:XX AM/PM" pattern="^ *(1[0-2]|[1-9]):[0-5][0-9] *(a|p|A|P)(m|M) *$" value="${currentEndTime}">
              <span class="mdl-textfield__error">Please use this format: XX:XX AM/PM</span>
            </div>
            <br />
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <label class="mdl-textfield__label" for="edit-event-password">RSVP Password</label>
              <input class="mdl-textfield__input" type="text" id="edit-event-password" name="edit-event-password" value="${currentPassword}">
            </div>
            <br />
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <label class="mdl-textfield__label" for="edit-event-rsvp-deadline">RSVP Deadline <em>(Will be match event date if left empty)</em></label>
              <input class="mdl-textfield__input" type="text" id="edit-event-rsvp-deadline" name="edit-event-rsvp-deadline" pattern="^([0]?[1-9]|[1][0-2])[./-]([0]?[1-9]|[1|2][0-9]|[3][0|1])[./-]([0-9]{4}|[0-9]{2})$" placeholder="MM/DD/YYYY" value="${currentDeadline}">
              <span class="mdl-textfield__error">Please use this format: MM/DD/YYYY</span>
            </div>
            <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="edit-guests-switch">
            <input type="checkbox" id="edit-guests-switch" name="edit-guests-switch" class="mdl-switch__input" value="yes" ${currentGuestAllow}>
              <span class="mdl-switch__label">Allow Guests? no/yes</span>
            </label>
            <div class="form-buttons">
              <div class="form-button">
                <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored" id="edit-event-do" type="submit" form="edit-event-form" data-event-id="${eventID}"><i class="material-icons">done</i></button>
              </div>
              <div class="form-button">
                <button class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect edit-close-btn" data-event-id="${eventID}"><i class="material-icons">close</i></button>
              </div>
            </div>
          </form>`).fadeIn();componentHandler.upgradeDom()})});$('body').on('click','.edit-close-btn',event=>{event.preventDefault();const eventID=$(event.target).parent().data('event-id');const $eventCard=$(event.target).closest('.event-card');$('#edit-event-form').fadeOut('fast',()=>{$eventCard.find(`#details-${eventID}`).fadeIn('fast');$('#edit-event-form').remove()})});$('body').on('click','#edit-event-do',event=>{event.preventDefault();const $form=$(event.target).closest('#edit-event-form');const eventID=$(event.target).parent().data('event-id');const $eventCard=$(event.target).closest('.event-card');editEvent(eventID,$form,$eventCard);$form.fadeOut('fast',()=>$form.remove())});$('body').on('click','li.delete-event',event=>{event.preventDefault();const $event=$(event.target);const eventID=$event.data('event-id');const confirmPanel=`
            <div class="mdl-card mdl-shadow--6dp" id="confirm-delete">
                <h3>Are you sure?</h3>
                <p>This will delete this event and all rsvps from the database</p>
                <div class="mdl-card__actions mdl-card--border">
                    <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--accent confirm-delete-btn"><i class="material-icons">delete</i></button>
                    <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--primary clear-delete-btn"><i class="material-icons">clear</i></button>
                </div>
            </div>`;$('body').append(confirmPanel);$('#confirm-delete').fadeToggle('fast');$('.clear-delete-btn').click(()=>{$('#confirm-delete').fadeToggle('fast',()=>$('#confirm-delete').remove())});$('.confirm-delete-btn').click(()=>{$('#confirm-delete').fadeToggle('fast',()=>$('#confirm-delete').remove());deleteEvent($event,eventID)})});$('body').on('click','li.toggle-listing',event=>{event.preventDefault();const eventID=$(event.target).data('event-id');const $eventCard=$(event.target).closest('.event-card');toggleEventListing(eventID,$eventCard)});$('body').on('change','.event-rsvp-switch',event=>{const eventID=$(event.target).data('event-id');const $eventCard=$(event.target).closest('.event-card');toggleEventRsvp(eventID,$eventCard)});function createEvent($form){showLoader();const formData=new FormData($form[0]);$.ajax({url:'inc/createEvent.php',method:'POST',data:formData,processData:!1,contentType:!1,dataType:'json',encode:!0,success:function(data,status,jqXHR){if(data.success){showToaster(data.message);$form[0].reset()}else{showToaster(`${data.message}: ${status}`)}
refreshEvents()}}).done(()=>{componentHandler.upgradeDom();hideLoader()})}
function editEvent(eventID,$form,$eventCard){showLoader();let formData=new FormData($form[0]);formData.append('eventID',eventID);$.ajax({url:'inc/editEvent.php',method:'POST',data:formData,processData:!1,contentType:!1,dataType:'json',encode:!0,success:(data,status,jqXHR)=>{if(data.success){$eventCard.find('h2').html(data.name);$eventCard.find('.event-description').html(data.description);$eventCard.find('.event-location').html(data.location);$eventCard.find('.event-address').html(data.address);$eventCard.find('.event-directions').attr('href','http://maps.google.com/?q='+data.address);$eventCard.find('.event-date').html(data.date);$eventCard.find('.event-time').html(data.time);$eventCard.find('.event-end-time').html(data.endTime);$eventCard.find('.event-password').html(data.password);$eventCard.find('.event-rsvp-deadline').html(data.deadline);$eventCard.find('.event-allow-guests').html(data.guests);showToaster(data.message)}else{showToaster(`${data.message}: ${status}`)}}}).done(()=>{$eventCard.find('#details-'+eventID).fadeIn('fast');hideLoader()})}
function deleteEvent($event,eventID){showLoader();const $eventCard=$event.closest('.event-card');$.ajax({url:'inc/deleteEvent.php',type:'POST',data:{'eventDeleted':eventID},dataType:'json',success:function(data,status,jqXHR){if(data.success){showToaster(data.message)}else{showToaster(`${data.message}: ${status}`)}}}).done(()=>{$eventCard.fadeToggle('slow',()=>$eventCard.remove());hideLoader()})}
function toggleEventListing(eventID,$eventCard){const $eventH3=$eventCard.find('h3');const $eventToggleButton=$eventCard.find('li.toggle-listing');showLoader();$.ajax({type:'POST',url:'inc/toggleListing.php',data:{'listingUpdated':eventID},dataType:'json',success:function(data,status,jqXHR){if(data.success){showToaster(data.message);if(parseInt(data.listed)===1){$eventH3.text("Details");$eventToggleButton.text('Remove from the events page')}else{$eventH3.text("Details - Inactive");$eventToggleButton.text('Add to the events page')}
$eventCard.toggleClass('inactive')}else{showToaster(`${data.message}: ${status}`)}}}).done(()=>hideLoader())}
function toggleEventRsvp(eventID,$eventCard){showLoader();$.ajax({url:'inc/toggleRsvp.php',type:'POST',dataType:'json',data:{'rsvpToggled':eventID},success:function(data,status,jqXHR){if(data.success){showToaster(data.message);let allowsGuests=parseInt(data.guests);if(allowsGuests===1){allowsGuests='Yes'}else{allowsGuests='No'}
let rsvpDate=new Date(data.date);if(parseInt(data.rsvps)===1){$('#details-'+eventID).append(`
                            <p id="rsvp-details-${eventID}">
                                <strong>RSVP Password:</strong> <span class="event-password">${data.password}</span><br />
                                <strong>RSVP Deadline:</strong> ${rsvpDate.getMonth() + 1}/${rsvpDate.getDate()}/${rsvpDate.getFullYear()}<br />
                                <strong>Allows guests?</strong> ${allowsGuests}
                            </p>`);$eventCard.find('.mdl-card__supporting-text').after(`
                            <div class="mdl-card__actions mdl-card--border">
                                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" href="<?php echo BASE_URL; ?>rsvps/?id=${eventID}">See Who\'s Coming</a>
                            </div>`)}else{$('#rsvp-details-'+eventID).remove();$eventCard.find('.mdl-card__actions').remove()}}else{showToaster(`${data.message}: ${status}`)}}}).done(()=>hideLoader())}
function refreshEvents(){const eventsListSection=document.getElementById('events-list');$.get('inc/eventsList.php',data=>eventsListSection.innerHTML=data).done(()=>componentHandler.upgradeDom())}
function showLoader(){const loader=$('#loader');loader.show()}
function hideLoader(){const loader=$('#loader');loader.hide()}
function showToaster(message){const messageSuccess=document.querySelector('#action-message');messageSuccess.MaterialSnackbar.showSnackbar({message:message})}})()
